<html>
  <head>
    <!-- When following links, don't grant destination access to this. -->
    <meta name="referrer" content="never">
    <title>Budget</title>
    <script type="text/javascript" src="/views/libs/jquery-2.1.1.js"></script>
    <script type="text/javascript" src="/views/libs/q.js"></script>
    <script type="text/javascript" src="/views/libs/capperConnect.js"></script>
    <script type="text/javascript" src="/views/libs/capperUtils.js"></script>

    <!-- http://getbootstrap.com/getting-started/ -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script src="/views/jspm_packages/system.js"></script>
    <script src="/views/config.js"></script>
    <script>
      System.import('/apps/ofxies/ui/budgetUI.js').then(function(budget) {
        budget.ui(CapperConnect.home, $);
      });
    </script>
  </head>
  <body class="container-fluid">
    <h1>Budget</h1>

    <div class='row'>
    <div class="col-xs-10">
      <h2>Current Accounts</h2>

      <div class="form-group small">
        <label>
          <input type="checkbox" disabled="disabled"/>
          Show zero-balance accounts (TODO)
        </label>
      </div>
      <div>
        <label>
          Current account codes
          <input name="currentCodes" disabled="disabled"
                 value="1000-2199 / 1500-1999"/>
        </label>
        <br />TODO: allow selection
      </div>

      <div id="error" class="collapse alert alert-danger"
           style="display: none" role="alert">
        <h4>Error</h4>
        <p id="errorMessage">...</p>
        <button class="btn btn-primary" type="button"
                data-target="#error" data-toggle="collapse">
          Close
        </button>
      </div>

      <div class="form-group">
    <table class='table table-bordered table-condensed table-hover'>
      <thead>
	<tr><th>Code</th><th>Account</th><th>Balance</th><th>Sync</th></tr>
      </thead>
      <tbody id='accounts'>
	<tr><td>stand by...</td></tr>
      </tbody>
    </table>
      </div>
      <div class="col-sm-offset-2 col-sm-10">
	<button id='fetchOFX' class="btn btn-info">Preview Sync</button>

	<button id='importOFX' class="btn btn-primary">Sync</button>
      </div>

      <table class='table table-bordered table-condensed table-hover'>
        <thead>
	  <tr>
            <th>Date</th><th>Num</th><th>Amount</th><th>Type</th>
            <th>Description</th><th>Memo</th>
          </tr>
        </thead>
        <tbody id='splits'>
        </tbody>
      </table>
    </div>
    </div>

    <p>@@@@@@@@@@</p>
    <form class="form-horizontal">
      <div class="form-group">
	<label for="expenseName" class="col-sm-2 control-label">
	  Expense account name:</label>
	<div class="col-sm-6">
	  <input id="expenseName" class="form-control" />
	</div>
      </div>
      <div class="form-group">
	<label for="since" class="col-sm-2 control-label">
	  Start Date:</label>
	<div class="col-sm-6">
	  <input type=date id="since" />
	</div>
      </div>

      <div class="form-group">
	<div class="col-sm-offset-2 col-sm-10">
	  <button onClick="getLedger(false)" class="btn">Get Ledger</button>
	  <button onClick="getLedger(true)" class="btn">Fetch New OFX</button>
	</div>
      </div>
      <div class="form-group">
	<label for="balCode" class="col-sm-2 control-label">
	  Balance account code:</label>
	<div class="col-sm-6">
	  <input id="balCode" />
	</div>
      </div>
      <div class="form=group">
	<div class="col-sm-offset-2 col-sm-10">
	  <button onClick="fetch()" class="btn">Fetch OFX</button>
	</div>
      </div>
      <div id='txns'>
	TXNS...
      </div>
    </form>

    <div id="printlnarea">
    </div>
  </body>
</html>
